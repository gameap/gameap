<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameAP - Debug Mode</title>
    <script>
        // Load theme from localStorage and apply it immediately
        (function() {
            let theme = 'light';
            try {
                const settings = localStorage.getItem('gameap_ui_settings');
                if (settings) {
                    const parsed = JSON.parse(settings);
                    theme = parsed.theme || 'light';
                } else {
                    const oldTheme = localStorage.getItem('gameap_theme');
                    if (oldTheme) {
                        theme = oldTheme;
                        localStorage.setItem('gameap_ui_settings', JSON.stringify({ theme: oldTheme }));
                        localStorage.removeItem('gameap_theme');
                    }
                }
            } catch (e) {
                console.error('Failed to load theme from localStorage:', e);
            }
            document.documentElement.classList.add(theme);
        })();

        // Initialize language detection
        (function() {
            function detectLanguage() {
                // Check localStorage first for user preference
                try {
                    const settings = localStorage.getItem('gameap_ui_settings');
                    if (settings) {
                        const parsed = JSON.parse(settings);
                        if (parsed.language) {
                            return parsed.language;
                        }
                    } else {
                        const oldLang = localStorage.getItem('gameap_lang');
                        if (oldLang) {
                            return oldLang;
                        }
                    }
                } catch (e) {
                    console.error('Failed to load language from localStorage:', e);
                }

                // In debug mode, default to 'en' instead of browser language
                // This prevents unexpected language changes based on system settings
                return 'en';
            }

            const lang = detectLanguage();
            const supportedLangs = ['en', 'ru'];
            const finalLang = supportedLangs.includes(lang) ? lang : 'en';

            document.documentElement.lang = finalLang;
            window.gameapLang = finalLang;

            // For debug mode, translations will be loaded via MSW mock
            // Initialize with empty object, will be populated after MSW starts
            window.i18n = {};

            // Debug mode flag
            window.gameapDebugMode = true;
        })();
    </script>
</head>
<body class="bg-white dark:bg-stone-800">
    <div id="app">
        <!-- Loading indicator while debug harness initializes -->
        <div id="debug-loader" style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: system-ui, sans-serif;
            color: #64748b;
        ">
            <div style="
                width: 40px;
                height: 40px;
                border: 3px solid #e2e8f0;
                border-top-color: #4f46e5;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            "></div>
            <p style="margin-top: 16px; font-size: 14px;">Initializing Debug Harness...</p>
            <p style="margin-top: 4px; font-size: 12px; opacity: 0.7;">Starting Mock Service Worker</p>
        </div>
        <style>
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        </style>
    </div>
    <!-- Debug harness entry point - loads MSW first, then the real app -->
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
