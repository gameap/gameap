# GameAP i18n (Internationalization)

## Overview

The GameAP frontend application supports multiple languages with automatic language detection and easy switching.

## Supported Languages

- **English (en)** - Default language
- **Russian (ru)**

## How It Works

### 1. Language Detection Priority

The system detects the user's language in the following order:

1. **localStorage** - `gameap_lang` key (user preference)
2. **HTML lang attribute** - `<html lang="...">`
3. **Browser language** - `navigator.language`
4. **Default** - Falls back to English (`en`)

### 2. Translation Loading

Translations are loaded **synchronously** before the Vue app initializes:

- Located in: `/lang/en.json` and `/lang/ru.json`
- Loaded via XHR in `index.html`
- Stored in `window.i18n` global object
- Language code stored in `window.gameapLang`

### 3. Build Process

When you run `npm run build`, the following happens:

```bash
# 1. prebuild script runs
mkdir -p public/lang
cp ../../internal/i18n/en.json public/lang/en.json
cp ../../internal/i18n/ru.json public/lang/ru.json

# 2. Vite builds and copies public/ to dist/
```

## Usage in Vue Components

### Using Translations

```vue
<template>
  <div>
    <h1>{{ trans('auth.sign_in') }}</h1>
    <p>{{ trans('auth.throttle', { seconds: 60 }) }}</p>
  </div>
</template>

<script setup>
// trans is available globally, no import needed
</script>
```

### Changing Language

```vue
<template>
  <button @click="switchToRussian">Русский</button>
  <button @click="switchToEnglish">English</button>
</template>

<script setup>
const switchToRussian = () => {
  changeLanguage('ru');
}

const switchToEnglish = () => {
  changeLanguage('en');
}
</script>
```

### Getting Current Language

```vue
<script setup>
import { getCurrentLanguage } from '@/i18n/i18n';

const currentLang = getCurrentLanguage(); // Returns 'en' or 'ru'
</script>
```

## Adding New Languages

1. **Add translation file** to `internal/i18n/`:
   ```
   internal/i18n/de.json  # German translations
   ```

2. **Update prebuild script** in `web/frontend/package.json`:
   ```json
   "prebuild": "mkdir -p public/lang && cp ../../internal/i18n/en.json public/lang/en.json && cp ../../internal/i18n/ru.json public/lang/ru.json && cp ../../internal/i18n/de.json public/lang/de.json"
   ```

3. **Update supported languages** in `web/frontend/index.html`:
   ```javascript
   const supportedLangs = ['en', 'ru', 'de'];
   ```

4. **Rebuild**:
   ```bash
   npm run build
   ```

## API Reference

### Functions

#### `trans(key, params)`
Translate a key with optional parameter replacement.

```javascript
trans('auth.sign_in')  // "Login"
trans('auth.throttle', { seconds: 60 })  // "Too many login attempts. Please try again in 60 seconds."
```

#### `changeLanguage(langCode)`
Change the application language (requires page reload).

```javascript
changeLanguage('ru')  // Saves to localStorage and reloads page
```

#### `getCurrentLanguage()`
Get the current language code.

```javascript
const lang = getCurrentLanguage()  // Returns 'en' or 'ru'
```

#### `pluralize(choice, count)`
Get pluralized form based on count (uses language-specific rules).

```javascript
pluralize('items', 1)   // "item"
pluralize('items', 5)   // "items"
```

## Testing

### Test Language Detection

1. **Open browser DevTools** → Console
2. **Check current language**:
   ```javascript
   console.log(window.gameapLang)  // 'en' or 'ru'
   ```

3. **Check loaded translations**:
   ```javascript
   console.log(window.i18n.auth.sign_in)  // "Login" or "Войти"
   ```

### Test Language Switching

1. **Open browser console**
2. **Switch language**:
   ```javascript
   changeLanguage('ru')  // Page will reload with Russian
   ```

3. **Check localStorage**:
   ```javascript
   localStorage.getItem('gameap_lang')  // 'ru'
   ```

## Console Messages

When the app loads, you'll see these messages:

```
[i18n] Loaded en translations successfully
```

Or in case of fallback:

```
[i18n] Failed to load ru translations: 404
[i18n] Fallback to English translations
```

## File Structure

```
web/frontend/
├── index.html              # Language detection & loading script
├── js/
│   └── i18n/
│       ├── i18n.js        # Translation utilities
│       └── plurals.js     # Plural forms for different languages
├── public/
│   └── lang/
│       ├── en.json        # English translations (copied from backend)
│       └── ru.json        # Russian translations (copied from backend)
└── package.json           # prebuild script to copy translations

internal/i18n/             # Source of truth (backend)
├── en.json
└── ru.json
```

## Notes

- Translations are loaded **before** Vue app initialization
- Language switching requires a **page reload** to load new translations
- User preference is saved in **localStorage**
- Fallback to English if requested language fails to load